# Work in progress

<br> Вспомнить, на чем закончился прошлый урок. Рассказать про секции в kaspresso и о методе step. Дать полную инфу о том, как это работает. 
<br> Переписать тест из прошлого урока к виду:

```kotlin

package com.kaspersky.kaspresso

import android.content.ActivityNotFoundException
import android.content.res.Configuration
import android.os.Build
import androidx.test.ext.junit.rules.activityScenarioRule
import com.kaspersky.kaspresso.device.exploit.Exploit
import com.kaspersky.kaspresso.screen.MainScreen
import com.kaspersky.kaspresso.screen.WifiScreen
import com.kaspersky.kaspresso.testcases.api.testcase.TestCase
import com.kaspersky.kaspresso.tutorial.MainActivity
import com.kaspersky.kaspresso.tutorial.R
import org.junit.Assert
import org.junit.Rule
import org.junit.Test

class WifiTestWithSections: TestCase() {

    @get:Rule
    val activityRule = activityScenarioRule<MainActivity>()

    @Test
    fun check_same_wifi_status_after_rotation() = before {
        device.exploit.setOrientation(Exploit.DeviceOrientation.Portrait)
        device.exploit.setAutoRotationEnabled(true)
        device.network.disable()
    }.after {
        device.exploit.setOrientation(Exploit.DeviceOrientation.Portrait)
        device.exploit.setAutoRotationEnabled(true)
        device.network.enable()
    }.run {

        step("Open target screen") {
            MainScreen {
                wifiActivityButton {
                    isVisible()
                    isClickable()
                    click()
                }
            }
        }

        step("Check correct wifi status") {
            WifiScreen {
                title.isVisible()
                btn.isClickable()
                title.hasEmptyText()
                tryToggleNetwork(false)
                btn.perform {
                    click()
                }
                title.hasText(R.string.disabled_status)
            }
        }

        step("Rotate device and check wifi status") {
            device.exploit.rotate()
            Assert.assertTrue(Configuration.ORIENTATION_LANDSCAPE == device.context.resources.configuration.orientation)
            WifiScreen.title.hasText(R.string.disabled_status)
        }
    }

    private fun tryToggleNetwork(shouldEnable: Boolean) {
        try {
            if (shouldEnable) {
                device.network.enable()
            } else {
                device.network.disable()
            }
        } catch (ex: ActivityNotFoundException) { // There's no WIFI activity on AVD with API < 25
            if (Build.VERSION.SDK_INT <= Build.VERSION_CODES.N) return
            throw ex
        }
    }
}
```

